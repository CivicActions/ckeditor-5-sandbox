!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CKEditor5=t():(e.CKEditor5=e.CKEditor5||{},e.CKEditor5.helpdrawerPlugin=t())}(self,(()=>(()=>{var e={"ckeditor5/src/core.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/core.js")},"ckeditor5/src/typing.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/typing.js")},"ckeditor5/src/ui.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/ui.js")},"ckeditor5/src/utils.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/utils.js")},"dll-reference CKEditor5.dll":e=>{"use strict";e.exports=CKEditor5.dll}},t={};function i(r){var s=t[r];if(void 0!==s)return s.exports;var l=t[r]={exports:{}};return e[r](l,l.exports,i),l.exports}i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r={};return(()=>{"use strict";i.d(r,{default:()=>w});var e=i("ckeditor5/src/core.js"),t=i("ckeditor5/src/typing.js");function s(e){return Array.from(e.getItems()).reduce(((e,t)=>t.is("text")||t.is("textProxy")?e+t.data:e),"")}var l=i("ckeditor5/src/utils.js");class o extends e.Command{refresh(){const e=this.editor.model,i=e.document.selection,r=i.getFirstRange();if(r.isCollapsed)if(i.hasAttribute("helpDrawer")){const r=i.getAttribute("helpDrawer"),l=(0,t.findAttributeRange)(i.getFirstPosition(),"helpDrawer",r,e);this.value={text:s(l),drawerId:r,range:l}}else this.value=null;else if(i.hasAttribute("helpDrawer")){const l=i.getAttribute("helpDrawer");(0,t.findAttributeRange)(i.getFirstPosition(),"helpDrawer",l,e).containsRange(r,!0)?this.value={text:s(r),drawerId:l,range:r}:this.value=null}else this.value=null;this.isEnabled=e.schema.checkAttributeInSelection(i,"helpDrawer")}execute({title:e,drawerId:t}){const i=this.editor.model,r=i.document.selection;i.change((s=>{if(r.isCollapsed){if(this.value){const{end:r}=i.insertContent(s.createText(e,{helpDrawer:t,class:["ds-c-help-drawer__toggle","ds-u-display--inline"]}),this.value.range);s.setSelection(r)}else if(""!==e){const o=r.getFirstPosition(),n=(0,l.toMap)(r.getAttributes());n.set("helpDrawer",t);const{end:a}=i.insertContent(s.createText(e,n),o);s.setSelection(a)}s.removeSelectionAttribute("helpDrawer")}else{const e=i.schema.getValidRanges(r.getRanges(),"helpDrawer");for(const i of e)s.setAttribute("helpDrawer",t,i)}}))}}class n extends e.Plugin{static get pluginName(){return"HelpDrawerEditing"}init(){this._defineSchema(),this._defineConverters(),this.editor.commands.add("insertHelpDrawer",new o(this.editor))}_defineSchema(){this.editor.model.schema.extend("$text",{allowAttributes:["helpDrawer"]})}_defineConverters(){const e=this.editor.conversion;e.for("downcast").attributeToElement({model:"helpDrawer",view:(e,{writer:t})=>t.createAttributeElement("a",{"data-drawer-id":e,class:"ds-c-help-drawer__toggle ds-u-display--inline"})}),e.for("upcast").elementToAttribute({view:{name:"a",attributes:["data-drawer-id"]},model:{key:"helpDrawer",value:e=>e.getAttribute("data-drawer-id")}})}}var a=i("ckeditor5/src/ui.js");class c extends a.View{constructor(t){super(t);const i=t.t;this.focusTracker=new l.FocusTracker,this.keystrokes=new l.KeystrokeHandler,this.formHeader=new a.FormHeaderView(t,{label:i("Edit help drawer trigger")}),this.titleInputView=this._createInput("Help Drawer Trigger Text"),this.titleInputView.infoText=i("Start typing the title of the term you want to link to, then select it from the select list."),this.drawerInputView=this._createInput("Term ID"),this.saveButtonView=this._createButton(i("Save"),e.icons.check,"ck-button-save"),this.saveButtonView.type="submit",this.cancelButtonView=this._createButton(i("Cancel"),e.icons.cancel,"ck-button-cancel"),this.cancelButtonView.delegate("execute").to(this,"cancel"),this.childViews=this.createCollection([this.formHeader,this.titleInputView,this.drawerInputView,this.saveButtonView,this.cancelButtonView]),this._focusCycler=new a.FocusCycler({focusables:this.childViews,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"form",attributes:{class:["ck","ck-drawer-form","ck-responsive-form"],tabindex:"-1"},children:this.childViews})}render(){super.render(),(0,a.submitHandler)({view:this}),this.childViews._items.forEach((e=>{this.focusTracker.add(e.element)})),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this.childViews.get(1).focus()}_createInput(e){const t=this.locale.t,i=new a.LabeledFieldView(this.locale,a.createLabeledInputText);return i.label=t(e),i}_createButton(e,t,i){const r=new a.ButtonView;return r.set({label:e,icon:t,tooltip:!0,class:i}),r}}const d=jQuery;class u extends e.Plugin{static get requires(){return[a.ContextualBalloon]}init(){const e=this.editor,t=this.editor.t;this._balloon=e.plugins.get(a.ContextualBalloon),this.formView=this._createFormView(),this._enableBalloonActivators(),e.ui.componentFactory.add("helpDrawer",(e=>{const i=new a.ButtonView(e);return i.set({label:t("Help Drawer"),icon:'<?xml version="1.0" encoding="utf-8"?>\n\x3c!-- Generator: Adobe Illustrator 25.3.1, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --\x3e\n<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n\t viewBox="0 0 75.7 75" style="enable-background:new 0 0 75.7 75;" xml:space="preserve">\n<style type="text/css">\n\t.st0{stroke:#000000;stroke-width:2;stroke-miterlimit:10;}\n</style>\n<path class="st0" d="M73.1,1H2.5C1.7,1,1,1.7,1,2.5v70C1,73.3,1.7,74,2.5,74h70.7c0.8,0,1.5-0.7,1.5-1.5v-70C74.6,1.7,74,1,73.1,1z\n\t M4,4h12.2v67H4V4z M71.6,71H19.1V4h52.5V71z"/>\n<path class="st0" d="M57.3,37.1H43.6V32c0-0.2-0.1-0.3-0.2-0.4c-0.2-0.1-0.3-0.1-0.5,0l-11.4,6.6c-0.2,0.1-0.2,0.3-0.2,0.4\n\ts0.1,0.3,0.2,0.4l11.4,6.6c0.1,0,0.2,0.1,0.2,0.1s0.2,0,0.2-0.1c0.2-0.1,0.2-0.3,0.2-0.4v-5.1h13.7c0.8,0,1.5-0.7,1.5-1.5\n\tS58.1,37.1,57.3,37.1z"/>\n</svg>\n',tooltip:!0}),this.listenTo(i,"execute",(()=>{this._showUI()})),i}))}_createFormView(){const e=this.editor,t=new c(e.locale);return this.listenTo(t,"submit",(()=>{const i={title:t.titleInputView.fieldView.element.value,drawerId:t.drawerInputView.fieldView.element.value};e.execute("insertHelpDrawer",i),this._hideUI()})),this.listenTo(t,"cancel",(()=>{this._hideUI()})),(0,a.clickOutsideHandler)({emitter:t,activator:()=>this._balloon.visibleView===t,contextElements:[this._balloon.view.element],callback:()=>this._hideUI()}),t}_showUI(){const e=this.editor.model.document.selection;this._enableDrawerAutocomplete();const t=this.editor.commands.get("insertHelpDrawer").value;this._balloon.add({view:this.formView,position:this._getBalloonPositionData()}),this.formView.drawerInputView.isEnabled=e.getFirstRange().isCollapsed,t?(this.formView.titleInputView.fieldView.value=t.text,this.formView.drawerInputView.fieldView.value=t.drawerId):(this.formView.titleInputView.fieldView.value="",this.formView.drawerInputView.fieldView.value=""),this.formView.focus()}_hideUI(){this.formView.titleInputView.fieldView.value="",this.formView.drawerInputView.fieldView.value="",this.formView.element.reset(),this._balloon.remove(this.formView),this.editor.editing.view.focus()}_getBalloonPositionData(){const e=this.editor.editing.view,t=e.document;let i=null;return i=()=>e.domConverter.viewRangeToDom(t.selection.getFirstRange()),{target:i}}_enableBalloonActivators(){const e=this.editor.editing.view.document;this.listenTo(e,"click",(()=>{this._getSelectedHelpDrawerElement()&&this._showUI()}))}_getSelectedHelpDrawerElement(){const e=this.editor.editing.view,t=e.document.selection,i=t.getSelectedElement();if(t.isCollapsed||i&&this._isHelpDrawer(i))return this._findHelpDrawerElementAncestor(t.getFirstPosition());{const i=t.getFirstRange().getTrimmed(),r=this._findHelpDrawerElementAncestor(i.start),s=this._findHelpDrawerElementAncestor(i.end);return r&&r===s&&e.createRangeIn(r).getTrimmed().isEqual(i)?r:null}}_findHelpDrawerElementAncestor(e){if(!e)return null;let t=e.parent;for(;t;){if(t.is("element")&&this._isHelpDrawer(t))return t;t=t.parent}return null}_isHelpDrawer(e){return!!e.hasAttribute("data-drawer-id")}_enableDrawerAutocomplete(){const e=this.editor,t=this.formView;let i=!1;e.plugins.get("ContextualBalloon")._rotatorView.content.on("add",((e,r)=>{if(r!==t||i)return;let s;!function(e,t){const{autocompleteUrl:i,selectHandler:r,closeHandler:s,openHandler:l}=t,o={cache:{},ajax:{dataType:"json",jsonp:!1}},n={appendTo:e.closest(".ck-labeled-field-view"),source:function(e,t){const{cache:r}=o;var s=e.term;r.hasOwnProperty(s)?t(r[s]):d.ajax(i,{success:function(e){r[s]=e,t(e)},data:{q:s},...o.ajax})},select:r,focus:()=>!1,search:()=>!n.isComposing,close:s,open:l,minLength:1,isComposing:!1},a=d(e).autocomplete(n);a.autocomplete("widget").addClass("helpdrawer-ui-autocomplete"),a.on("click",(function(){a.autocomplete("search",a.val())})),a.on("compositionstart.autocomplete",(function(){n.isComposing=!0})),a.on("compositionend.autocomplete",(function(){n.isComposing=!1}))}(t.titleInputView.fieldView.element,{autocompleteUrl:Drupal.url("admin/cke5_helpdrawer_plugin/helpdrawer/autocomplete"),selectHandler:(e,{item:i})=>{if(i.label||i.value){if(!i.label||!i.value)throw"Missing path param."+JSON.stringify(i);this.set("drawerId",i.id),this.set("title",i.label)}else this.set("drawerId",null),this.set("title",null);return t.titleInputView.fieldView.value=i.label,t.drawerInputView.fieldView.value=i.id,s=!0,!1},openHandler:e=>{s=!1},closeHandler:e=>{s||(this.set("drawerId",null),this.set("title",null)),s=!1}}),i=!0,t.titleInputView.fieldView.template.attributes.class.push("form-helpdrawer-autocomplete")}))}}class h extends e.Plugin{static get requires(){return[n,u]}}const w={HelpDrawer:h}})(),r=r.default})()));